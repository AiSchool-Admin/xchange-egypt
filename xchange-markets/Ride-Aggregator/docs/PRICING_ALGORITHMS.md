# خوارزميات التسعير - Xchange Transport
# Pricing Algorithms Documentation

## نظرة عامة (Overview)

نستخدم خوارزميات تسعير محاكية للتطبيقات الحقيقية مع تعديلات ديناميكية حسب الطلب.

## معادلة التسعير الأساسية (Base Pricing Formula)

```
السعر النهائي = max(الحد الأدنى, (الأجرة الأساسية + رسوم المسافة + رسوم الوقت + رسوم الحجز) × معامل الطلب)
```

```typescript
finalPrice = Math.max(
  minimumFare,
  (baseFare + (distance × perKmRate) + (duration × perMinRate) + bookingFee) × surgeMultiplier
);
```

---

## تفاصيل التسعير لكل مزود (Provider Pricing Details)

### 1. Uber أوبر

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| UberX | 15 ج.م | 5.5 ج.م | 0.8 ج.م | 5 ج.م | 25 ج.م |
| Comfort | 20 ج.م | 7 ج.م | 1 ج.م | 7 ج.م | 35 ج.م |
| Black | 35 ج.م | 12 ج.م | 1.5 ج.م | 10 ج.م | 60 ج.م |
| XL | 25 ج.م | 8 ج.م | 1.2 ج.م | 8 ج.م | 45 ج.م |

**مثال: رحلة 10 كم في 25 دقيقة (UberX)**
```
السعر = 15 + (10 × 5.5) + (25 × 0.8) + 5 = 15 + 55 + 20 + 5 = 95 ج.م
```

---

### 2. Careem كريم

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| Go | 12 ج.م | 5 ج.م | 0.7 ج.م | 4 ج.م | 22 ج.م |
| Go Plus | 18 ج.م | 6.5 ج.م | 0.9 ج.م | 6 ج.م | 32 ج.م |
| Business | 30 ج.م | 10 ج.م | 1.3 ج.م | 9 ج.م | 55 ج.م |

**مثال: رحلة 10 كم في 25 دقيقة (Go)**
```
السعر = 12 + (10 × 5) + (25 × 0.7) + 4 = 12 + 50 + 17.5 + 4 = 83.5 ج.م
```

---

### 3. Bolt بولت

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| Bolt | 10 ج.م | 4.5 ج.م | 0.6 ج.م | 3 ج.م | 18 ج.م |
| Bolt Plus | 15 ج.م | 6 ج.م | 0.85 ج.م | 5 ج.م | 28 ج.م |

**مثال: رحلة 10 كم في 25 دقيقة (Bolt)**
```
السعر = 10 + (10 × 4.5) + (25 × 0.6) + 3 = 10 + 45 + 15 + 3 = 73 ج.م
```

---

### 4. inDrive إن درايف

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| City | 8 ج.م | 4 ج.م | 0.5 ج.م | 2 ج.م | 15 ج.م |
| Comfort | 12 ج.م | 5.5 ج.م | 0.75 ج.م | 4 ج.م | 25 ج.م |

**ملاحظة:** inDrive يسمح للمستخدم بالتفاوض على السعر، السعر المعروض هو السعر المقترح.

---

### 5. DiDi ديدي

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| Express | 11 ج.م | 4.8 ج.م | 0.65 ج.م | 3.5 ج.م | 20 ج.م |
| Plus | 16 ج.م | 6.2 ج.م | 0.9 ج.م | 5.5 ج.م | 30 ج.م |

---

### 6. Swvl سويفل (باصات)

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| Bus | 5 ج.م | 1.5 ج.م | 0.2 ج.م | 2 ج.م | 10 ج.م |

**ملاحظة:** أسعار Swvl ثابتة لكل خط وليست ديناميكية.

---

### 7. Halan هلان

| نوع السيارة | الأجرة الأساسية | سعر الكيلو | سعر الدقيقة | رسوم الحجز | الحد الأدنى |
|------------|----------------|-----------|------------|-----------|-----------|
| Bike | 5 ج.م | 2 ج.م | 0.3 ج.م | 1 ج.م | 10 ج.م |
| Tuk-Tuk | 8 ج.م | 3 ج.م | 0.4 ج.م | 2 ج.م | 12 ج.م |

---

## معاملات الطلب (Surge Multipliers)

تتغير الأسعار حسب الوقت والطلب:

| الفترة | التوقيت | معامل الطلب |
|-------|--------|------------|
| الليل المتأخر | 00:00 - 06:00 | 0.9x (خصم 10%) |
| الذروة الصباحية | 06:00 - 08:00 | 1.3x (+30%) |
| ذروة الصباح | 08:00 - 10:00 | 1.5x (+50%) |
| ساعات طبيعية | 10:00 - 14:00 | 1.0x (عادي) |
| بعد الظهر | 14:00 - 16:00 | 1.1x (+10%) |
| ذروة المساء | 16:00 - 18:00 | 1.4x (+40%) |
| ذروة الليل | 18:00 - 20:00 | 1.6x (+60%) |
| الليل | 20:00 - 22:00 | 1.2x (+20%) |
| الليل المتأخر | 22:00 - 24:00 | 1.0x (عادي) |

---

## خوارزمية التوصية الذكية (AI Recommendation)

نستخدم نظام تسجيل مرجح لتحديد أفضل عرض:

```typescript
recommendationScore = (priceScore × 0.4) + (etaScore × 0.3) + (surgeScore × 0.2) + (reliabilityScore × 0.1)
```

| العامل | الوزن | الحساب |
|-------|------|--------|
| السعر | 40% | `100 - (price / 2)` - كلما انخفض السعر زادت النقاط |
| وقت الوصول | 30% | `100 - (eta × 10)` - كلما قل الوقت زادت النقاط |
| معامل الطلب | 20% | `100 - ((surge - 1) × 50)` - كلما انخفض الـ surge زادت النقاط |
| الموثوقية | 10% | تقييم المزود التاريخي |

**تقييمات الموثوقية:**
- Uber: 95%
- Careem: 92%
- Swvl: 90%
- Bolt: 88%
- DiDi: 85%
- inDrive: 80%
- Halan: 78%

---

## حساب المسافة (Distance Calculation)

نستخدم معادلة Haversine لحساب المسافة بين نقطتين:

```typescript
function calculateDistance(lat1: number, lng1: number, lat2: number, lng2: number): number {
  const R = 6371; // نصف قطر الأرض بالكيلومتر
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
```

**ملاحظة:** هذه المسافة الجغرافية المباشرة. المسافة الفعلية للطريق أطول بـ 20-40%.

---

## حساب وقت الوصول المتوقع (ETA Calculation)

```typescript
function calculateETA(distanceKm: number): number {
  const baseMinutes = 3; // وقت انتظار أساسي
  const trafficFactor = surgeMultiplier > 1.3 ? 1.5 : 1.0; // عامل الزحام
  return Math.round(baseMinutes + (Math.random() * 5 * trafficFactor));
}
```

---

## مستوى الدقة والتحسينات المستقبلية

### الوضع الحالي:
- الأسعار **تقريبية** بناءً على الخوارزميات العامة
- مستوى الثقة: **70-95%** حسب المزود والوقت

### التحسينات المخططة:
1. **تكامل API حقيقي** مع كل مزود للحصول على أسعار فورية
2. **تعلم آلي** لتحسين دقة التنبؤ
3. **بيانات تاريخية** لتحسين معاملات الطلب
4. **Google Maps API** للحصول على المسافة الفعلية للطريق
