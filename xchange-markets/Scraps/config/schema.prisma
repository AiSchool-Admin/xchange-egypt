// prisma/schema.prisma
// Xchange Scrap Marketplace Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// ENUMS
// ==========================================

enum UserType {
  individual    // فرد
  collector     // روبابيكيا/جامع
  dealer        // تاجر
  company       // شركة
  recycler      // مصنع تدوير
  admin         // مدير
}

enum ListingType {
  sell          // للبيع
  buy           // للشراء
  auction       // مزاد
}

enum ListingStatus {
  draft         // مسودة
  pending       // في الانتظار
  active        // نشط
  sold          // تم البيع
  expired       // منتهي
  cancelled     // ملغي
}

enum PickupStatus {
  pending       // في انتظار التعيين
  assigned      // تم تعيين جامع
  confirmed     // تأكيد الموعد
  on_the_way    // الجامع في الطريق
  arrived       // وصل
  weighing      // جاري الوزن
  payment       // في انتظار الدفع
  completed     // تم بنجاح
  cancelled     // ملغي
  disputed      // نزاع
}

enum TransactionStatus {
  pending       // في الانتظار
  confirmed     // مؤكد
  in_progress   // جاري
  completed     // مكتمل
  cancelled     // ملغي
  disputed      // نزاع
}

enum PaymentMethod {
  cash              // نقداً
  wallet            // محفظة Xchange
  bank_transfer     // تحويل بنكي
  fawry             // فوري
  vodafone_cash     // فودافون كاش
  instapay          // انستاباي
}

enum PaymentStatus {
  pending       // في الانتظار
  paid          // مدفوع
  refunded      // مسترد
  failed        // فشل
}

enum VehicleType {
  tricycle      // تروسيكل
  pickup        // بيك أب
  truck         // شاحنة
  van           // فان
  none          // بدون
}

enum BusinessType {
  shop          // محل
  warehouse     // مخزن
  factory       // مصنع
  recycler      // مصنع تدوير
}

enum ContractStatus {
  draft             // مسودة
  pending_approval  // في انتظار الموافقة
  active            // نشط
  suspended         // موقوف
  completed         // مكتمل
  terminated        // منهي
}

enum PriceSource {
  manual        // إدخال يدوي
  lme           // بورصة لندن
  market        // السوق المحلي
  algorithm     // خوارزمية
}

enum QualityGrade {
  premium       // ممتاز
  standard      // عادي
  mixed         // مخلوط
  low           // منخفض
}

enum TimeSlot {
  morning       // صباحاً (9-12)
  afternoon     // ظهراً (12-4)
  evening       // مساءً (4-8)
}

enum Unit {
  kg            // كيلوجرام
  ton           // طن
  piece         // قطعة
  unit          // وحدة
}

// ==========================================
// USERS & AUTHENTICATION
// ==========================================

model User {
  id                    String    @id @default(uuid())
  phone                 String    @unique
  phoneVerified         Boolean   @default(false) @map("phone_verified")
  email                 String?
  name                  String?
  nationalId            String?   @map("national_id")
  nationalIdVerified    Boolean   @default(false) @map("national_id_verified")
  userType              UserType  @map("user_type")
  
  // Company Info (for company/dealer accounts)
  companyName           String?   @map("company_name")
  commercialRegister    String?   @map("commercial_register")
  taxId                 String?   @map("tax_id")
  
  // Profile
  profileImageUrl       String?   @map("profile_image_url")
  
  // Address
  addressGovernorate    String?   @map("address_governorate")
  addressCity           String?   @map("address_city")
  addressStreet         String?   @map("address_street")
  addressLat            Decimal?  @map("address_lat") @db.Decimal(10, 8)
  addressLng            Decimal?  @map("address_lng") @db.Decimal(11, 8)
  
  // Stats
  ratingAvg             Decimal   @default(0) @map("rating_avg") @db.Decimal(3, 2)
  ratingCount           Int       @default(0) @map("rating_count")
  totalTransactions     Int       @default(0) @map("total_transactions")
  totalWeightKg         Decimal   @default(0) @map("total_weight_kg") @db.Decimal(12, 2)
  walletBalance         Decimal   @default(0) @map("wallet_balance") @db.Decimal(12, 2)
  
  // Status
  isVerified            Boolean   @default(false) @map("is_verified")
  isActive              Boolean   @default(true) @map("is_active")
  
  // Timestamps
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  
  // Relations
  listings              Listing[]
  pickupRequestsAsSeller    PickupRequest[] @relation("PickupSeller")
  pickupRequestsAsCollector PickupRequest[] @relation("PickupCollector")
  transactionsAsSeller  Transaction[] @relation("TransactionSeller")
  transactionsAsBuyer   Transaction[] @relation("TransactionBuyer")
  reviewsGiven          Review[] @relation("ReviewsGiven")
  reviewsReceived       Review[] @relation("ReviewsReceived")
  priceAlerts           PriceAlert[]
  collector             Collector?
  dealer                Dealer?
  contractsAsSeller     B2BContract[] @relation("ContractSeller")
  contractsAsBuyer      B2BContract[] @relation("ContractBuyer")
  pricesCreated         Price[] @relation("PriceCreator")
  
  @@index([phone])
  @@index([userType])
  @@index([addressGovernorate])
  @@index([isVerified])
  @@map("users")
}

model OTP {
  id          String   @id @default(uuid())
  phone       String
  code        String
  attempts    Int      @default(0)
  expiresAt   DateTime @map("expires_at")
  verifiedAt  DateTime? @map("verified_at")
  createdAt   DateTime @default(now()) @map("created_at")
  
  @@index([phone, code])
  @@map("otps")
}

model RefreshToken {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  token       String   @unique
  expiresAt   DateTime @map("expires_at")
  createdAt   DateTime @default(now()) @map("created_at")
  
  @@index([userId])
  @@map("refresh_tokens")
}

// ==========================================
// MATERIALS & CATEGORIES
// ==========================================

model MaterialCategory {
  id              String    @id @default(uuid())
  nameAr          String    @map("name_ar")
  nameEn          String    @map("name_en")
  slug            String    @unique
  parentId        String?   @map("parent_id")
  iconUrl         String?   @map("icon_url")
  descriptionAr   String?   @map("description_ar")
  descriptionEn   String?   @map("description_en")
  sortOrder       Int       @default(0) @map("sort_order")
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  
  // Relations
  parent          MaterialCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children        MaterialCategory[] @relation("CategoryHierarchy")
  materialTypes   MaterialType[]
  
  @@map("material_categories")
}

model MaterialType {
  id              String    @id @default(uuid())
  categoryId      String    @map("category_id")
  nameAr          String    @map("name_ar")
  nameEn          String    @map("name_en")
  slug            String    @unique
  descriptionAr   String?   @map("description_ar")
  descriptionEn   String?   @map("description_en")
  unit            Unit      @default(kg)
  minQuantity     Decimal   @default(1) @map("min_quantity") @db.Decimal(10, 2)
  imageUrl        String?   @map("image_url")
  qualityGrades   Json?     @map("quality_grades")
  isActive        Boolean   @default(true) @map("is_active")
  sortOrder       Int       @default(0) @map("sort_order")
  createdAt       DateTime  @default(now()) @map("created_at")
  
  // Relations
  category        MaterialCategory @relation(fields: [categoryId], references: [id])
  prices          Price[]
  listings        Listing[]
  priceAlerts     PriceAlert[]
  b2bContracts    B2BContract[]
  
  @@index([categoryId])
  @@index([slug])
  @@map("material_types")
}

// ==========================================
// PRICING
// ==========================================

model Price {
  id              String      @id @default(uuid())
  materialTypeId  String      @map("material_type_id")
  qualityGrade    QualityGrade @default(standard) @map("quality_grade")
  pricePerKg      Decimal     @map("price_per_kg") @db.Decimal(10, 2)
  pricePerTon     Decimal?    @map("price_per_ton") @db.Decimal(12, 2)
  currency        String      @default("EGP")
  source          PriceSource @default(manual)
  governorate     String?
  effectiveDate   DateTime    @map("effective_date") @db.Date
  expiryDate      DateTime?   @map("expiry_date") @db.Date
  notes           String?
  createdById     String?     @map("created_by_id")
  createdAt       DateTime    @default(now()) @map("created_at")
  
  // Relations
  materialType    MaterialType @relation(fields: [materialTypeId], references: [id])
  createdBy       User?        @relation("PriceCreator", fields: [createdById], references: [id])
  
  @@unique([materialTypeId, qualityGrade, governorate, effectiveDate])
  @@index([materialTypeId])
  @@index([effectiveDate])
  @@index([governorate])
  @@map("prices")
}

model PriceAlert {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  materialTypeId  String    @map("material_type_id")
  alertType       String
  threshold       Decimal   @db.Decimal(10, 2)
  isActive        Boolean   @default(true) @map("is_active")
  lastTriggeredAt DateTime? @map("last_triggered_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  
  // Relations
  user            User         @relation(fields: [userId], references: [id])
  materialType    MaterialType @relation(fields: [materialTypeId], references: [id])
  
  @@index([userId])
  @@index([materialTypeId])
  @@map("price_alerts")
}

// ==========================================
// LISTINGS
// ==========================================

model Listing {
  id                  String        @id @default(uuid())
  userId              String        @map("user_id")
  listingType         ListingType   @map("listing_type")
  materialTypeId      String        @map("material_type_id")
  title               String
  description         String?
  qualityGrade        QualityGrade  @default(standard) @map("quality_grade")
  quantityKg          Decimal       @map("quantity_kg") @db.Decimal(12, 2)
  quantityEstimated   Boolean       @default(false) @map("quantity_estimated")
  pricePerKg          Decimal?      @map("price_per_kg") @db.Decimal(10, 2)
  priceTotal          Decimal?      @map("price_total") @db.Decimal(12, 2)
  priceNegotiable     Boolean       @default(true) @map("price_negotiable")
  minQuantityKg       Decimal?      @map("min_quantity_kg") @db.Decimal(10, 2)
  images              Json?
  
  // Address
  addressGovernorate  String        @map("address_governorate")
  addressCity         String?       @map("address_city")
  addressDetails      String?       @map("address_details")
  addressLat          Decimal?      @map("address_lat") @db.Decimal(10, 8)
  addressLng          Decimal?      @map("address_lng") @db.Decimal(11, 8)
  
  // Options
  pickupAvailable     Boolean       @default(true) @map("pickup_available")
  deliveryAvailable   Boolean       @default(false) @map("delivery_available")
  
  // Status
  status              ListingStatus @default(pending)
  featured            Boolean       @default(false)
  viewsCount          Int           @default(0) @map("views_count")
  inquiriesCount      Int           @default(0) @map("inquiries_count")
  
  // Timestamps
  expiresAt           DateTime?     @map("expires_at")
  soldAt              DateTime?     @map("sold_at")
  createdAt           DateTime      @default(now()) @map("created_at")
  updatedAt           DateTime      @updatedAt @map("updated_at")
  
  // Relations
  user                User          @relation(fields: [userId], references: [id])
  materialType        MaterialType  @relation(fields: [materialTypeId], references: [id])
  transactions        Transaction[]
  
  @@index([userId])
  @@index([materialTypeId])
  @@index([listingType])
  @@index([status])
  @@index([addressGovernorate])
  @@index([createdAt(sort: Desc)])
  @@map("listings")
}

// ==========================================
// PICKUP REQUESTS (C2B)
// ==========================================

model PickupRequest {
  id                  String        @id @default(uuid())
  requestNumber       String        @unique @map("request_number")
  userId              String        @map("user_id")
  collectorId         String?       @map("collector_id")
  
  // Materials
  materials           Json
  totalEstimatedKg    Decimal?      @map("total_estimated_kg") @db.Decimal(10, 2)
  totalActualKg       Decimal?      @map("total_actual_kg") @db.Decimal(10, 2)
  
  // Pricing
  estimatedPrice      Decimal?      @map("estimated_price") @db.Decimal(10, 2)
  finalPrice          Decimal?      @map("final_price") @db.Decimal(10, 2)
  platformFee         Decimal?      @map("platform_fee") @db.Decimal(10, 2)
  collectorPayout     Decimal?      @map("collector_payout") @db.Decimal(10, 2)
  
  // Address
  addressGovernorate  String        @map("address_governorate")
  addressCity         String        @map("address_city")
  addressStreet       String        @map("address_street")
  addressBuilding     String?       @map("address_building")
  addressFloor        String?       @map("address_floor")
  addressLandmark     String?       @map("address_landmark")
  addressLat          Decimal?      @map("address_lat") @db.Decimal(10, 8)
  addressLng          Decimal?      @map("address_lng") @db.Decimal(11, 8)
  
  // Schedule
  preferredDate       DateTime      @map("preferred_date") @db.Date
  preferredTimeSlot   TimeSlot      @default(morning) @map("preferred_time_slot")
  
  // Status
  status              PickupStatus  @default(pending)
  
  // Collector Location
  collectorLocationLat Decimal?     @map("collector_location_lat") @db.Decimal(10, 8)
  collectorLocationLng Decimal?     @map("collector_location_lng") @db.Decimal(11, 8)
  collectorLocationUpdatedAt DateTime? @map("collector_location_updated_at")
  
  // Notes
  userNotes           String?       @map("user_notes")
  collectorNotes      String?       @map("collector_notes")
  cancellationReason  String?       @map("cancellation_reason")
  
  // Timestamps
  assignedAt          DateTime?     @map("assigned_at")
  confirmedAt         DateTime?     @map("confirmed_at")
  arrivedAt           DateTime?     @map("arrived_at")
  completedAt         DateTime?     @map("completed_at")
  cancelledAt         DateTime?     @map("cancelled_at")
  createdAt           DateTime      @default(now()) @map("created_at")
  updatedAt           DateTime      @updatedAt @map("updated_at")
  
  // Relations
  user                User          @relation("PickupSeller", fields: [userId], references: [id])
  collector           User?         @relation("PickupCollector", fields: [collectorId], references: [id])
  transaction         Transaction?
  
  @@index([userId])
  @@index([collectorId])
  @@index([status])
  @@index([preferredDate])
  @@index([addressGovernorate])
  @@map("pickup_requests")
}

// ==========================================
// TRANSACTIONS
// ==========================================

model Transaction {
  id                  String            @id @default(uuid())
  transactionNumber   String            @unique @map("transaction_number")
  
  // Parties
  sellerId            String            @map("seller_id")
  buyerId             String            @map("buyer_id")
  
  // Source
  sourceType          String            @map("source_type")
  listingId           String?           @map("listing_id")
  pickupRequestId     String?           @unique @map("pickup_request_id")
  b2bContractId       String?           @map("b2b_contract_id")
  
  // Materials
  materials           Json
  totalWeightKg       Decimal           @map("total_weight_kg") @db.Decimal(12, 2)
  
  // Financials
  subtotal            Decimal           @db.Decimal(12, 2)
  platformFeeSeller   Decimal           @default(0) @map("platform_fee_seller") @db.Decimal(10, 2)
  platformFeeBuyer    Decimal           @default(0) @map("platform_fee_buyer") @db.Decimal(10, 2)
  deliveryFee         Decimal           @default(0) @map("delivery_fee") @db.Decimal(10, 2)
  totalAmount         Decimal           @map("total_amount") @db.Decimal(12, 2)
  
  // Payment
  paymentMethod       PaymentMethod     @map("payment_method")
  paymentStatus       PaymentStatus     @default(pending) @map("payment_status")
  paymentReference    String?           @map("payment_reference")
  paidAt              DateTime?         @map("paid_at")
  
  // Status
  status              TransactionStatus @default(pending)
  
  // Timestamps
  confirmedAt         DateTime?         @map("confirmed_at")
  completedAt         DateTime?         @map("completed_at")
  cancelledAt         DateTime?         @map("cancelled_at")
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  
  // Relations
  seller              User              @relation("TransactionSeller", fields: [sellerId], references: [id])
  buyer               User              @relation("TransactionBuyer", fields: [buyerId], references: [id])
  listing             Listing?          @relation(fields: [listingId], references: [id])
  pickupRequest       PickupRequest?    @relation(fields: [pickupRequestId], references: [id])
  b2bContract         B2BContract?      @relation(fields: [b2bContractId], references: [id])
  reviews             Review[]
  
  @@index([sellerId])
  @@index([buyerId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@map("transactions")
}

// ==========================================
// REVIEWS
// ==========================================

model Review {
  id                String      @id @default(uuid())
  transactionId     String      @map("transaction_id")
  reviewerId        String      @map("reviewer_id")
  reviewedId        String      @map("reviewed_id")
  
  // Ratings
  rating            Int
  weightAccuracy    Int?        @map("weight_accuracy")
  qualityAccuracy   Int?        @map("quality_accuracy")
  punctuality       Int?
  communication     Int?
  
  // Content
  comment           String?
  images            Json?
  
  // Meta
  isVerified        Boolean     @default(true) @map("is_verified")
  createdAt         DateTime    @default(now()) @map("created_at")
  
  // Relations
  transaction       Transaction @relation(fields: [transactionId], references: [id])
  reviewer          User        @relation("ReviewsGiven", fields: [reviewerId], references: [id])
  reviewed          User        @relation("ReviewsReceived", fields: [reviewedId], references: [id])
  
  @@unique([transactionId, reviewerId])
  @@index([reviewedId])
  @@map("reviews")
}

// ==========================================
// COLLECTORS & DEALERS
// ==========================================

model Collector {
  id                    String      @id @default(uuid())
  userId                String      @unique @map("user_id")
  
  vehicleType           VehicleType @default(tricycle) @map("vehicle_type")
  vehiclePlate          String?     @map("vehicle_plate")
  vehicleCapacityKg     Decimal?    @map("vehicle_capacity_kg") @db.Decimal(10, 2)
  
  serviceGovernorates   Json?       @map("service_governorates")
  serviceCities         Json?       @map("service_cities")
  serviceRadiusKm       Int         @default(10) @map("service_radius_km")
  
  isAvailable           Boolean     @default(true) @map("is_available")
  workingHours          Json?       @map("working_hours")
  
  totalPickups          Int         @default(0) @map("total_pickups")
  totalWeightCollectedKg Decimal    @default(0) @map("total_weight_collected_kg") @db.Decimal(12, 2)
  avgRating             Decimal     @default(0) @map("avg_rating") @db.Decimal(3, 2)
  completionRate        Decimal     @default(100) @map("completion_rate") @db.Decimal(5, 2)
  
  currentLat            Decimal?    @map("current_lat") @db.Decimal(10, 8)
  currentLng            Decimal?    @map("current_lng") @db.Decimal(11, 8)
  locationUpdatedAt     DateTime?   @map("location_updated_at")
  
  isVerified            Boolean     @default(false) @map("is_verified")
  isActive              Boolean     @default(true) @map("is_active")
  
  createdAt             DateTime    @default(now()) @map("created_at")
  updatedAt             DateTime    @updatedAt @map("updated_at")
  
  user                  User        @relation(fields: [userId], references: [id])
  
  @@index([isAvailable, isActive])
  @@map("collectors")
}

model Dealer {
  id                  String        @id @default(uuid())
  userId              String        @unique @map("user_id")
  
  businessName        String        @map("business_name")
  businessType        BusinessType  @map("business_type")
  specializations     Json?
  
  addressGovernorate  String        @map("address_governorate")
  addressCity         String        @map("address_city")
  addressStreet       String?       @map("address_street")
  addressLat          Decimal?      @map("address_lat") @db.Decimal(10, 8)
  addressLng          Decimal?      @map("address_lng") @db.Decimal(11, 8)
  
  phoneSecondary      String?       @map("phone_secondary")
  whatsapp            String?
  workingHours        Json?         @map("working_hours")
  
  hasScale            Boolean       @default(false) @map("has_scale")
  scaleCapacityKg     Decimal?      @map("scale_capacity_kg") @db.Decimal(10, 2)
  hasLoadingEquipment Boolean       @default(false) @map("has_loading_equipment")
  acceptsSmallQuantities Boolean    @default(true) @map("accepts_small_quantities")
  minQuantityKg       Decimal       @default(1) @map("min_quantity_kg") @db.Decimal(10, 2)
  
  offersPickup        Boolean       @default(false) @map("offers_pickup")
  pickupFeePerKm      Decimal?      @map("pickup_fee_per_km") @db.Decimal(6, 2)
  
  totalTransactions   Int           @default(0) @map("total_transactions")
  totalWeightKg       Decimal       @default(0) @map("total_weight_kg") @db.Decimal(14, 2)
  avgRating           Decimal       @default(0) @map("avg_rating") @db.Decimal(3, 2)
  
  isVerified          Boolean       @default(false) @map("is_verified")
  isFeatured          Boolean       @default(false) @map("is_featured")
  isActive            Boolean       @default(true) @map("is_active")
  
  createdAt           DateTime      @default(now()) @map("created_at")
  updatedAt           DateTime      @updatedAt @map("updated_at")
  
  user                User          @relation(fields: [userId], references: [id])
  dealerPrices        DealerPrice[]
  
  @@index([addressGovernorate])
  @@index([businessType])
  @@index([isVerified, isActive])
  @@map("dealers")
}

model DealerPrice {
  id              String      @id @default(uuid())
  dealerId        String      @map("dealer_id")
  materialTypeId  String      @map("material_type_id")
  qualityGrade    QualityGrade @default(standard) @map("quality_grade")
  buyPricePerKg   Decimal     @map("buy_price_per_kg") @db.Decimal(10, 2)
  sellPricePerKg  Decimal?    @map("sell_price_per_kg") @db.Decimal(10, 2)
  updatedAt       DateTime    @updatedAt @map("updated_at")
  
  dealer          Dealer      @relation(fields: [dealerId], references: [id])
  
  @@unique([dealerId, materialTypeId, qualityGrade])
  @@map("dealer_prices")
}

// ==========================================
// B2B CONTRACTS
// ==========================================

model B2BContract {
  id                    String          @id @default(uuid())
  contractNumber        String          @unique @map("contract_number")
  sellerId              String          @map("seller_id")
  buyerId               String          @map("buyer_id")
  
  materialTypeId        String          @map("material_type_id")
  qualityGrade          QualityGrade    @map("quality_grade")
  quantityKgPerPeriod   Decimal         @map("quantity_kg_per_period") @db.Decimal(12, 2)
  periodType            String          @map("period_type")
  pricePerKg            Decimal         @map("price_per_kg") @db.Decimal(10, 2)
  priceAdjustmentFormula String?        @map("price_adjustment_formula")
  
  startDate             DateTime        @map("start_date") @db.Date
  endDate               DateTime        @map("end_date") @db.Date
  autoRenew             Boolean         @default(false) @map("auto_renew")
  
  deliveryTerms         String?         @map("delivery_terms")
  paymentTerms          String?         @map("payment_terms")
  qualityStandards      String?         @map("quality_standards")
  penalties             String?
  
  status                ContractStatus  @default(draft)
  
  esgCertificateRequired Boolean        @default(false) @map("esg_certificate_required")
  esgCertificateUrl     String?         @map("esg_certificate_url")
  
  createdAt             DateTime        @default(now()) @map("created_at")
  updatedAt             DateTime        @updatedAt @map("updated_at")
  
  seller                User            @relation("ContractSeller", fields: [sellerId], references: [id])
  buyer                 User            @relation("ContractBuyer", fields: [buyerId], references: [id])
  materialType          MaterialType    @relation(fields: [materialTypeId], references: [id])
  transactions          Transaction[]
  
  @@index([sellerId])
  @@index([buyerId])
  @@index([status])
  @@map("b2b_contracts")
}

// ==========================================
// NOTIFICATIONS & SYSTEM
// ==========================================

model Notification {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  type        String
  title       String
  body        String
  data        Json?
  isRead      Boolean   @default(false) @map("is_read")
  readAt      DateTime? @map("read_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  @@index([userId, isRead])
  @@index([createdAt(sort: Desc)])
  @@map("notifications")
}

model WalletTransaction {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  type            String
  amount          Decimal   @db.Decimal(12, 2)
  balanceAfter    Decimal   @map("balance_after") @db.Decimal(12, 2)
  reference       String?
  referenceType   String?   @map("reference_type")
  description     String?
  createdAt       DateTime  @default(now()) @map("created_at")
  
  @@index([userId])
  @@index([createdAt(sort: Desc)])
  @@map("wallet_transactions")
}

model SystemConfig {
  id          String    @id @default(uuid())
  key         String    @unique
  value       Json
  description String?
  updatedAt   DateTime  @updatedAt @map("updated_at")
  
  @@map("system_config")
}

model AuditLog {
  id          String    @id @default(uuid())
  userId      String?   @map("user_id")
  action      String
  entityType  String    @map("entity_type")
  entityId    String    @map("entity_id")
  oldValue    Json?     @map("old_value")
  newValue    Json?     @map("new_value")
  ipAddress   String?   @map("ip_address")
  userAgent   String?   @map("user_agent")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt(sort: Desc)])
  @@map("audit_logs")
}
